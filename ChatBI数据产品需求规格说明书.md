# ChatBI数据产品需求规格说明书

### 一、产品概述

#### 1.1 产品目标

构建一款支持自然语言交互的智能数据分析产品（ChatBI），通过多轮对话澄清用户查询意图，结合本地知识库实现多维度数据洞察归因与固定路径数据总结，输出精准图表与报告，同时保障数据安全与可解释性，降低数据分析门槛，提升决策效率。

#### 1.2 核心应用场景

覆盖两类核心数据分析场景，满足不同用户的分析需求：



* 场景一：数据洞察归因场景（灵活分析）

* 场景二：数据总结场景（固定路径分析）

### 二、核心场景详细需求

#### 2.1 场景一：数据洞察归因场景

##### 2.1.1 核心目标

解决多维度交叉问题分析需求，支持用户通过自然语言发起灵活查询，智能识别分析维度与目标，输出数据结论与适配图表。

##### 2.1.2 交互流程



1. 用户输入自然语言查询（支持多维度交叉提问，如 “2024 年 Q3 华北地区电子产品的退货率与客单价的相关性分析”）；

2. 系统若识别查询模糊（如缺少时间维度、地区范围不明确），通过多轮对话澄清（如 “请问你关注的时间范围是 2024 年 Q3 还是 Q2？华北地区是否包含内蒙古？”）；

3. 系统结合本地知识库（元数据、指标定义、表关系）解析查询意图，生成对应 SQL 查询数据；

4. 自动分析数据规律，总结问题结论（如 “2024 年 Q3 华北地区电子产品退货率与客单价呈负相关，客单价高于 5000 元的产品退货率仅为 3.2%”）；

5. 智能匹配图表类型（如散点图展示相关性、柱状图对比不同客单价区间退货率），支持用户切换图表样式（折线图、饼图等）。

##### 2.1.3 关键要求



* 支持无限层级多维度交叉分析（如时间、地区、产品类别、用户画像等维度自由组合）；

* 图表生成需贴合分析目标，避免无效可视化（如趋势分析优先折线图，占比分析优先饼图）；

* 结论总结需简洁精准，突出核心洞察，避免冗余描述。

#### 2.2 场景二：数据总结场景

##### 2.2.1 核心目标

针对有固定分析路径的场景（如月度经营总结、周度销售复盘），用户输入关键参数后，自动按预设路径取数、生成指定图表与标准化报告。

##### 2.2.2 交互流程



1. 系统提供固定分析模板配置入口（支持管理员录入 / 编辑模板，如 “月度销售总结模板”“渠道效果分析模板”）；

2. 模板需定义：固定分析维度（如时间：自然月、地区：全国各省份）、必选参数（如统计月份、业务线）、图表类型（如销售总额用柱状图、同比增长率用折线图）、报告结构（如核心数据、环比 / 同比分析、问题预警、改进建议）；

3. 用户选择目标模板，输入必填参数（如 “2024 年 9 月”“家电业务线”）；

4. 系统按模板预设的分析路径自动关联数据表查询数据，验证数据完整性后生成指定图表；

5. 按模板结构整合数据、图表与分析结论，生成标准化总结报告，支持用户下载（PDF/Excel 格式）、编辑报告内容（如补充人工备注）。

##### 2.2.3 关键要求



* 模板支持灵活配置：可自定义分析维度、指标组合、报告段落结构、图表样式；

* 报告生成需保证格式统一，数据与图表一一对应，支持批量导出多周期报告；

* 支持模板版本管理，历史模板可回溯、复用。

### 三、核心功能模块需求

#### 3.1 多轮对话澄清模块



* 模糊查询识别：自动检测查询中缺失的关键信息（时间、地区、指标定义、维度范围等），准确率≥98%；

* 上下文延续：支持对话上下文记忆，后续提问可基于历史澄清信息，无需重复输入（如用户先说明 “分析 2024 年 Q3 数据”，后续提问 “退货率最高的产品类别” 可自动关联时间维度）；

* 澄清话术优化：提问简洁明确，避免引导性问题，支持用户中途修改已澄清信息（如 “之前说的时间范围改为 2024 年 Q2”）。

#### 3.2 数据安全与权限模块



* 数据访问权限配置：支持按角色（管理员、普通用户、只读用户）、部门分配数据访问范围，细化到数据表 / 字段级别（如销售部用户仅可访问本部门销售数据，不可查看财务敏感字段）；

* 敏感字段脱敏：管理员可配置敏感字段清单（如用户手机号、银行卡号、核心毛利数据），脱敏规则支持：部分隐藏（如手机号显示为 138\*\***5678）、替换为 “**\*”、权限校验可见（仅指定角色可查看原始数据）；

* 操作日志审计：记录所有用户的查询行为（查询内容、查询时间、访问的数据表、导出 / 下载操作），日志保留期≥1 年，支持按用户、时间、操作类型检索。

#### 3.3 准确性保障模块



* 准确率标准：查询结果准确率＞95%（数值类查询误差≤±1%，维度匹配类查询无错误关联）；

* 测试集定义：

1. 覆盖场景：包含单维度查询、多维度交叉查询、模糊查询（需澄清）、固定模板查询四类，每类测试用例≥100 条；

2. 测试指标：结果准确率（核心）、澄清有效性（模糊查询是否准确识别缺失信息）、模板匹配准确率（参数输入后是否按预设路径执行）；

* 数据校验机制：查询结果生成后，自动校验数据完整性（无缺失值 / 异常值）、逻辑一致性（如同比增长率计算是否正确），异常数据标注并提示用户。

#### 3.4 可解释性模块



* 查询逻辑说明：每一次查询结果（含图表、报告）均附带 “逻辑说明” 入口，点击展示：①查询意图解析过程（用户问题→核心指标→关联维度）；②数据来源（涉及的数据表名称、字段名称）；③SQL 语句（脱敏敏感字段，支持复制查看）；④计算逻辑（如指标计算公式、同比 / 环比计算规则）；

* 说明可读性：避免技术术语堆砌，用通俗语言解释核心逻辑，技术细节（如 SQL）可折叠展示，满足不同用户需求（业务用户看通俗说明，技术用户看详细逻辑）。

#### 3.5 数据可理解性模块（本地知识库建设）



* 元数据管理：

1. 支持手动录入 / 批量导入数据库、表、字段的元数据信息，包括：数据库名称及用途、表名称及业务场景、字段名称、数据类型、字段说明（如 “user\_id：用户唯一标识”）；

2. 支持元数据标注（如 “核心表”“临时表”“维度字段”“指标字段”），方便 LLM 快速识别；

* 指标定义管理：

1. 录入核心业务指标的详细定义，包括：指标名称、英文缩写、计算逻辑（如 “退货率 = 退货订单数 / 总订单数 ×100%”）、统计口径（如 “订单数统计以支付成功为准”）、适用场景；

2. 支持指标关联维度标注（如 “退货率可按时间、地区、产品类别拆分”）；

* 表关系管理：

1. 录入数据表之间的关联关系，包括：关联表名称、关联字段（如 “销售表.sku\_id = 产品表.sku\_id”）、关联类型（一对一 / 一对多）；

2. 支持可视化展示表关系图谱，方便管理员维护，同时为 LLM 生成 SQL 提供关联依据；

* 知识库更新：支持管理员实时编辑、更新元数据、指标定义、表关系，修改记录可回溯，更新后即时同步至 LLM 分析参考库。

### 四、非功能需求

#### 4.1 性能要求



* 响应时间：单维度查询响应时间≤3 秒，多维度交叉查询≤5 秒，固定模板报告生成≤10 秒；

* 并发支持：同时在线用户≤500 人，并发查询请求≤100 条 / 秒，无响应延迟或崩溃；

* 数据更新：支持对接实时数据接口（如 T+0 实时同步）和离线数据（如 T+1 同步），同步频率可配置，同步过程不影响查询功能使用。

#### 4.2 兼容性要求



* 终端兼容：支持 PC 端（Chrome、Edge、Firefox 浏览器，版本≥90）、移动端（微信小程序、H5 页面）；

* 数据对接：支持主流数据库（MySQL、Oracle、Hive、ClickHouse），支持 API 接口对接第三方数据平台，数据格式兼容 CSV、Excel、JSON。

#### 4.3 易用性要求



* 交互设计：符合用户习惯，自然语言查询支持口语化表达（如 “最近三个月哪个产品卖得最好”），无需专业术语；

* 学习成本：新用户无需培训即可完成基础查询，复杂功能（如模板配置）提供操作指引（图文教程 / 视频教程）；

* 错误提示：操作错误（如参数输入格式错误、无权限访问数据）时，提示信息明确，给出解决方案（如 “请输入正确的日期格式：YYYY-MM”“您暂无访问财务数据的权限，请联系管理员申请”）。
