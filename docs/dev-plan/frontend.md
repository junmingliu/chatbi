# Frontend Plan (apps/web)

范围：仅覆盖 MVP “数据洞察归因/灵活分析”场景的主链路 UI/UX 与前端工程化。

## M0 工程化骨架 (2-4 天)

- 初始化工程
  - 创建 `apps/web/`（Vite + React + TS，开启 `strict: true` / `noImplicitAny`）
  - 路由：React Router（最少 `/(chat)` 主页）
  - 数据请求：TanStack Query 基础封装（QueryClient + 统一错误翻译）
- 代码质量
  - ESLint + Prettier 配置与脚本（lint/format/typecheck）
  - Vitest + React Testing Library 运行样例（至少 1 个组件测试）
  - Playwright 结构占位（先不要求可跑，但目录/脚本/示例用例就位）
- UI 设计系统落地（最小）
  - 统一 tokens：颜色/间距/圆角/阴影（按工程规范 UI 章节）
  - 基础组件：Button/Input/Panel/Toast（或选定 UI 库后包装）

验收：
- `apps/web` 可启动；lint/format/test 可本地运行；CI 后续可挂上。

## M1 端到端最小链路（先不做澄清/KB）(3-5 天)

- 页面结构
  - Chat 页面：输入区 + 结果区（Tab：表格/图表/逻辑说明(占位)）
  - 支持会话列表占位（不做完整管理也行，但预留 UI 结构）
- API 对接
  - 定义前端 DTO（请求/响应）并与后端对齐
  - `POST /api/chat/message` 请求：先用“结构化消息/或自然语言直通”占位
  - 响应渲染：
    - Table：可分页/TopN 展示
    - Chart：渲染后端返回的 chart spec（MVP 可先支持 1-2 种图）
    - Summary：结论文本块
- 失败/加载态
  - Loading skeleton、重试按钮、可操作错误提示（指导用户下一步）

验收：
- 给定固定输入（不含自然语言解析），页面可稳定出表格/图表。

## M2 多轮澄清交互 + 会话上下文 (5-7 天)

- 澄清 UI
  - 系统澄清气泡（展示缺失项问题）
  - 用户补充回答后自动续跑
  - 支持“修改已澄清信息”入口（例如：时间范围改为 Q2）
- 会话能力（前端侧）
  - 会话 id 管理、消息流渲染（流式可选）
  - 页面刷新后恢复会话（MVP 可先 localStorage；后续换后端会话）

验收：
- 缺失时间/地区/指标等时可被追问；补齐后得到结果。

## M3 KB/SQL 生成可视化辅助 (7-10 天)

- “逻辑说明”面板雏形
  - 展示：意图解析摘要、数据来源（表/字段）、SQL（脱敏可复制）占位
  - 对技术细节折叠/展开
- 图表交互增强
  - 图表类型切换（由后端/agent 提供候选）
  - 表格排序/筛选（前端本地/后端参数二选一，先走简单方案）

验收：
- 用户能理解“怎么查出来的”，并能复制 SQL（脱敏）。

## M4 权限/脱敏/审计相关前端任务 (5-7 天)

- 权限反馈
  - 无权限时提示：缺少哪些权限、如何申请（文案可配置）
  - 对敏感字段展示脱敏标识（例如：mask 图标/tooltip）
- 审计可见性（MVP）
  - 查询结果页提供 trace_id 展示与复制
  - “审计入口”占位（管理员菜单项）

验收：
- 权限/脱敏行为在 UI 上可解释、可定位（trace_id）。

## M5 质量门禁 + E2E 主链路 (5-7 天)

- 单元测试（Vitest）
  - Chat 输入/消息流/错误提示的关键用例
- E2E（Playwright）
  - 主链路：提问 -> 澄清 -> 出图 -> 查看逻辑说明
  - 关键断言：图表渲染成功、表格有数据、trace_id 可见
- 性能/体验
  - 请求超时提示、取消请求（若后端支持 cancel）

验收：
- 前端单测 + E2E 主链路可稳定跑通。
